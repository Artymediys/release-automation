# ARel – Auto Release
Приложение для автоматического выпуска релиза из исходной ветки в целевую, с формированием новой версии и тега.

Под релизом подразумевается совершение 2 или 3 шагов:
1) Добавление новой записи в CHANGELOG.md исходной ветки проекта
2) Force Push / Merge исходной ветки в целевую ветку или пропуск этого шага, в случае указания только одной ветки
3) Создание релизного тега из целевой ветки

## Интерфейс
Пользовательский интерфейс состоит из нескольких этапов:
0) **Конфигурация приложения** – на этом этапе предлагается ввести адрес `GitLab` и `PAT` (Personal Access Token):
   - `GitLab URL` – Адрес может выглядеть так: https://gitlab.example.com
   - `PAT` – Можно получить в настройках юзера: _User settings –> Access tokens_

    Этот этап появляется только при первом запуске, после чего введённые данные сохраняются в файл `.arel.yaml`
    в домашней директории пользователя.

1) **Выбор группы и проектов внутри этой группы** – этап делится на две части:
   1) Выбор одной из групп, доступных вашему пользователю
   2) Выбор проектов, входящих в указанную группу, с помощью английской буквы `x`.
      Также доступны поиск по названию, который можно активировать с помощью символа `/`, и возврат к выбору группы с помощью клавиши `Tab`

2) **Выбор исходной (source) и целевой (target) ветки** – на этом этапе отображаются общие ветки для ранее выбранных проектов.
   - Сначала предлагается выбрать исходную ветку, а затем выбрать целевую ветку
   - Если выбрать одну и ту же ветку в двух местах, то программа отработает только для указанной одной ветки
   - Все бинды (горячие клавиши) работают аналогично предыдущему этапу

3) **Версия и комментарий** – на этом этапе можно указать номер новой версии и комментарий к этой версии.
   - Версию можно задать тремя способами:
     - В формате `major.minor.build` (к примеру - `1.6.3`)
     - В формате `build` (к примеру `42`). В таком случае `major.minor` будут взяты из последней записи в `CHANGELOG.md`
     - Можно оставить поле пустым, перейдя к заполнению комментария.
       В таком случае `major.minor` будут взяты из последней записи в `CHANGELOG.md`, а `build` будет сформирован автоматически
       в формате `YYMMDDHHmm`. К примеру, запись `2501261504` будет означать `15:04, 26.01.2025`
   - Комментарий можно заполнить, а можно оставить пустым. В таком случае он будет заполнен по шаблону: 
     > Новая версия <номер_версии> от <дата>, запушено юзером <имя пользователя пк>
   - С помощью клавиши `Tab` можно вернуться из поля с комментарием к полю для ввода версии

4) **Подтверждение действий** – на этом этапе предлагается проверить указанные ранее группу, проекты, ветки, версию, комментарий.
   - Если утвердить выбор, то запустится выпуск релиза
   - Если отклонить выбор, то программа завершит своё выполнение

## Логирование
В процессе работы приложения, формируется два лог-файла, которые находятся в директории `logs`,
создающейся по тому же пути, где находится приложение:
- `arel_main.log` - Содержит записи всех действий, происходящих в процессе работы приложения
- `arel-result_<data>.log` - Содержит статусы выполнения ключевых событий релиза

## Сборка и запуск
В директории `./bin` лежат сборки приложения под разные ОС.

### Зависимости
Для работы c собранным приложением, требуется установленный **git** на устройстве.

Для самостоятельной сборки и последующего запуска, требуется установленный **Go** версии `>=1.22.5`.

### Запуск собранного приложения
Приложение не имеет каких-либо аргументов и флагов.
Для запуска требуется обратиться к файлу, который находится в директории с требуемой ОС и архитектурой: 
```shell
./bin/<ОС>/arel_<архитектура>
```

### Самостоятельная сборка
В корне репозитория находится bash-скрипт `build.sh` для сборки приложения под необходимую ОС и архитектуру.

Скрипт можно запустить вместе с аргументами:
1) Сборка приложения под предустановленные ОС и архитектуры, а именно –> **windows amd64**; **linux amd64**;
**macos amd64** и **arm64**
```shell
./build.sh all
```

2) Сборка приложения под конкретную ОС. Из доступных вариантов -> **windows**; **linux**, **macos**
```shell
./build.sh <ОС>
```

Также скрипт можно запустить без аргументов. Тогда он соберёт приложение под текущую ОС и архитектуру, 
на которой был запущен скрипт:
```shell
./build.sh
```

Если требуется собрать приложение под ОС или архитектуру, которой нет в стандартном наборе скрипта `build.sh`,
тогда можно посмотреть список доступных для сборки ОС и архитектуры командой:
```shell
go tool dist list
```
после чего выполнить следующую команду для сборки:

**Linux/MacOS**
```shell
env GOOS=<ОС> GOARCH=<архитектура> go build -o <название итогового файла>
```

**Windows/Powershell**
```shell
$env:GOOS="<ОС>"; $env:GOARCH="<архитектура>"; go build -o <название итогового файла>
```

**Windows/cmd**
```shell
set GOOS=<ОС> && set GOARCH=<архитектура> && go build -o <название итогового файла>
```